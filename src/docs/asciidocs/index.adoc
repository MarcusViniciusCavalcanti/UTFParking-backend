= Api - UTFParking
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 4
:sectlinks:
:operation-curl-request-title: Example request
:operation-http-response-title: Example response

[[overview]]
== Overview

Api para o sistema UTFParking, de alunos para alunos.

Esta api está agnostica de clientes deste que uso protocolos **HTTP**, seja ele a aplicação de reconhecimento
ou web.

## Começando
Esta documentação ira auxiliar novas implementações de __clients sides__, dando uma base
de como manipular os recursos que a API provem.

|===
| Repositório da api| https://github.com/MarcusViniciusCavalcanti/UTFParking-backend[]
| Exemplo de __client side (**React**)__| https://github.com/MarcusViniciusCavalcanti/UTFParking-frontend[]
| Exemplo de __sistema de reconhecimento (**React**)__| https://github.com/MarcusViniciusCavalcanti/UTFParking-recgonizer[]
|===

[[overview-http-verbs]]
=== HTTP Verbs

Esta Api foi construída seguindo os padrões RESTFull, tentando aderir o mais próximo
possíveis as suas conveções em seu uso dos verbos HTTP

|===
| Verb | Usage

| `GET`
| Usado para recuperar recursos

| `POST`
| Usado para crear um recurso

| `PUT`
| Usado para atualizar, parcialmente ou completamente.

| `DELETE`
| Usado para remover um recurso existente.
|===

[[overview-http-status-codes]]
=== HTTP status codes

Esta Api foi construída seguindo os padrões RESTFull, tentando aderir o mais próximo
possíveis as suas convenções em seu uso dos códigos de Status HTTP

|===
| Status code | Usage

| `200 OK`
| Para requisições aceitas e processadas

| `201 Created`
| Um novo recurso foi criado com sucesso. O URI do recurso está disponível a partir da resposta
`Localização` body.link._self.href

| `204 No Content`
| Requisição foi processada e não há respostas para tal

| `400 Bad Request`
| Requisição negada, pois está mal formatada, exemplo de retorno de erro quando
a falta de um atributo, no corpo da mensagem.

| `404 Not Found`
| Este recurso não foi encontrado.

| `409 Conflict`
| O recurso já existe com as informações dada.

| `422 Unprocessable Entity`
| Requisição negada, pois não passou na validação da requisição, um atributo nulo ou
ultrapassou o limite de caracteres, são exemplos.
|===


[[security]]
== Segurança

As requisições feitas para Api serão STATELESS (**Sem estado**), logo a utilização de Token para
autorizar uma determinada requisição se faz necessário, assim a Api para Autorizar e autenticar um usuário
fica a cargo do JWT.

[[security-headers]]
=== Headers

Toda requisição, exceto para requisitar um token e requisições advinda do dispositivo (este utiliza outro tipo de autorização, vide: <<security-device>>),
deverá conter um Header `Authorization` contendo um portador (`Bearer`).

Exemplo:
[source,http,options="nowrap"]
----
Authorization: Bearer <TOKEN>
----

[[security-error-messagens]]
=== Resposta de error

==== Não Autenticado
Caso a requisição não contenha o header acima, excluido as que não carece de autenticação, será retornar uma mensagem
de error com **status code** `401`.

Exemplo:
include::{snippets}/authenticate/Login/failure/unauthorized/http-response.adoc[]

---
==== Não Autorizado
Para os casos de não autorizado, a mensagem de erro retornada será com **status code** `403`.

Exemplo:
include::{snippets}/authenticate/Login/failure/forbidden/http-response.adoc[]


##Consute sessão de errors para mais informações sobre os campos da mensagem.##

[[security-autehtntication-login]]
=== Login

|===
|POST |`/ap/v1/login`
|===

Para criar um token **/api/v1/login** passando as credenciais, username e password.

IMPORTANT: As requisições para login, serão validadas, consulte: <<erros-badrequest>> para mais informações

Exemplo:
include::{snippets}/authenticate/Login/success/http-request.adoc[]

include::{snippets}/authenticate/Login/success/response-fields.adoc[]

TIP: Para recuperar o usuário da do token clique <<users-get-me, aqui>> para ter informações.

[[security-device]]
=== Autorizando Dispositivo

[[users]]
== Usuários

Usuário e um recurso da api, que representa quem utiliza do sistema, seja ele operador, motorista, ou administrador

Os tipos de usuário será definido no campo `type`, este campo defini o comportamento do sistema para atribuição de perfils.

**SERVICE**: Servidores, professores, colaboradores em geral

**STUDENT**: Alunos do campus:

Os tipos definem quais possíveis perfils serão atribuido a um usuário, as restrições serão:

|===
|**SERVICE** |Podera ter perfil de ADMIN, OPERATOR, DRIVE
|**STUDENT** |Tera apenas perfil de DRIVE
|===

Para mais informações dos perfil consulte a sessão de Perfils, <<roles>>

Para controle do acesso, cada usuário poderá ter apenas um <<cars>> cadastrado no sistema, porém cada usuário
podera alterar o carro quando lhe for conveniente.

Campos:
include::{snippets}/user/create/success/response-fields.adoc[]

Links:
include::{snippets}/user/create/success/links.adoc[]

___
[[users-delete]]
=== Criando Usuários
|===
|METHOD|URI|ROLE

|POST
|`/ap/v1/users`
|**ADMIN**
|===

Cria um recurso usuário.

Requisição:
include::{snippets}/user/create/success/http-request.adoc[]

Descrição dos campos:
include::{snippets}/user/create/success/request-fields.adoc[]

Resposta:
include::{snippets}/user/create/success/http-response.adoc[]

---
##### Respostas de error

`422`
Para error de validação de campos:
include::{snippets}/user/create/error/validation/http-response.adoc[]
##Consute sessão de errors para mais informações sobre os campos da mensagem.##

`409`
Para username já existe:
include::{snippets}/user/create/error/username/http-response.adoc[]

___

[[users-get]]
=== Recuperando Usuários
|===
|METHOD|URI|ROLE

|GET
|`/ap/v1/users/{ID}`
|**ADMIN**, **OPERATOR**
|===

Para recuperar um determinado usuário, deve-se informar o id do usuário.

include::{snippets}/user/get/success/path-parameters.adoc[]

Requisição:
include::{snippets}/user/get/success/http-request.adoc[]

Resposta:
include::{snippets}/user/get/success/http-response.adoc[]

---
##### Respostas de error
`404`
Para usuário não existe:
include::{snippets}/user/get/error/http-response.adoc[]

[[users-get-me]]
=== Recuperando Usuários da sessão
|===
|METHOD|URI|ROLE

|GET
|`/ap/v1/users/me`
|**ADMIN**, **OPERATOR**, **DRIVER**
|===

Requisição:
include::{snippets}/user/me/success/http-request.adoc[]

Resposta:
include::{snippets}/user/me/success/http-response.adoc[]

---
[[users-delete]]
=== Deletando Usuários
|===
|METHOD|URI|ROLE

|DELETE
|`/ap/v1/users/{ID}`
|**ADMIN**
|===

Remover um determinado recurso usuário.

Requisição:
include::{snippets}/user/delete/success/http-request.adoc[]

Resposta:
include::{snippets}/user/delete/success/http-response.adoc[]

IMPORTANT: Não é possível remover o usuário da mesma sessão,
caso isso ocorra um error será lançado com código de status`422`

---
##### Respostas de error
`404`
Para usuário não existe:
include::{snippets}/user/get/error/http-response.adoc[]

___
[[roles]]
== Perfils

[[cars]]
== Carro


[[erros-badrequest]]
=== Bad Request

